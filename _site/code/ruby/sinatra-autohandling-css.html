<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta content='GROW UP' http-equiv='X-UA-Compatible' />
    <meta content='width=850' name='viewport' />
    <title>GusG.us - Sinatra: auto-handling any CSS</title>
    <link href='/images/gusgus_icon.gif' rel='icon' />
    <link href='http://gusg.us/feed.xml' rel='alternate' title='GusG.us' type='application/rss+xml' />
    <link href="/stylesheets/reset-min.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/application.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/pygment-native.css" type="text/css" media="screen" rel="stylesheet"/>
  </head>

  <body>
    <div class='container'>
      <div id='header'>
        <a href='http://gusg.us'>
          <img src='/images/gus-logo.png' />
        </a>
        <span class='nav'>
          <a href='/'>Home</a>
          <a href='/life'>Life</a>
          <a href='/work'>Work</a>
          <a href='/code'>Code</a>
          <a href='/code/ruby'>Ruby</a>
          <a href='/code/erlang'>Erlang</a>
        </span>
        <a href='http://feeds.feedburner.com/gusgus' rel='alternate' type='application/rss+xml'>
          <img src='http://www.feedburner.com/fb/images/pub/feed-icon16x16.png' />
        </a>
      </div>

      <div id="article">
  <div class="header">
    <h1>Sinatra: auto-handling any CSS</h1>
    <div class="date"><cite>Aug 28, 2008</cite></div>
    <div class="summary">If you're like me, you don't want to explicitly define a handler for each CSS file in Sinatra</div>
    <div class="clear"></div>
  </div>
  <h4 id='update'>Update</h4>

<ol>
<li>I have included this functionality in my <a href='http://github.com/thumblemonks/chicago'>Chicago</a> gem</li>
</ol>
<hr />
<p>My <a href='http://annealer.org'>buddy</a> and I like .. no, love &#8230; <a href='http://www.imdb.com/title/tt0137523/'>Fight Club</a>; more the movie than the book. We can&#8217;t help but quote it like &#8230; all the damn time. We&#8217;ll even use the quotes to express ourselves; especially those that start with <em>&#8220;I am Jack&#8217;s &#8230;&#8221;</em></p>

<p>So, we thought it would be a good idea to start a site called <a href='http://iamjacks.org'>I am Jack&#8217;s</a> to allow us and others to go this site and enter their phrases for the moment. We also figured it would be neat to watch Twitter&#8217;s public timeline for such statements and report on them.</p>

<p>But, that&#8217;s NOT the point of this article. The point of this article is to highlight a little thing we did while implementing the site. See, we normally do stuff in Rails because, well, it&#8217;s pretty easy. However, we wanted to do something new and do something simple.</p>

<h3 id='sinatra'>Sinatra</h3>

<p>Talk about simple. <a href='http://sinatrarb.com'>Sinatra</a> rocks. But, that&#8217;s still not the point of this article. The point of this article is to highlight this little thing. Remember?</p>

<p>The little thing, and I do mean little, was to add a handler for CSS that can handle any stylesheet request. See, most of the examples for handling CSS in Sinatra look like this:</p>
<div class='highlight'><pre><span class='n'>get</span> <span class='s1'>&#39;/stylesheet.css&#39;</span> <span class='k'>do</span>
  <span class='n'>content_type</span> <span class='s1'>&#39;text/css&#39;</span><span class='p'>,</span> <span class='ss'>:charset</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;utf-8&#39;</span>
  <span class='n'>sass</span> <span class='ss'>:stylesheet</span>
<span class='k'>end</span>
</pre>
</div>
<p>Or, they render the CSS directly in the app.</p>

<p>I. Don&#8217;t. Like. That.</p>

<p>I want all my view related code in one place and I know that all my CSS will be handled the same way. In my app, I want to do this:</p>
<div class='highlight'><pre><span class='nb'>require</span> <span class='s1'>&#39;sinatra&#39;</span>

<span class='n'>catch_all_css</span>

<span class='c1'># handle everything else</span>
</pre>
</div>
<p>Which should run any resource that matches <code>*.css</code> through a Sass builder. Easy peasy:</p>
<div class='highlight'><pre><span class='k'>def</span> <span class='nf'>catch_all_css</span>
  <span class='n'>get</span> <span class='s1'>&#39;/*.css&#39;</span> <span class='k'>do</span>
    <span class='n'>header</span> <span class='s1'>&#39;Content-Type&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;text/css; charset=utf-8&#39;</span>
    <span class='n'>sass</span> <span class='n'>request</span><span class='o'>.</span><span class='n'>env</span><span class='o'>[</span><span class='s2'>&quot;PATH_INFO&quot;</span><span class='o'>].</span><span class='n'>match</span><span class='p'>(</span><span class='sr'>%r[\/(.+)\.css]</span><span class='p'>)</span><span class='o'>[</span><span class='mi'>1</span><span class='o'>].</span><span class='n'>to_sym</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</pre>
</div>
<p>Yep; it works. But, this solution only works well when the stylesheet is requested off the doc-root. If you want to handle <code>/stylesheets/*.css</code>, you&#8217;ll just have to modify the regular expression a little or get it through URI.</p>

<h3 id='possible_changes'>Possible changes</h3>

<p>You may not want to use Sass. Why you wouldn&#8217;t want to I don&#8217;t understand, but you just may not want to. Here is a possible modification to the above that may work.</p>
<div class='highlight'><pre><span class='nb'>require</span> <span class='s1'>&#39;sinatra&#39;</span>

<span class='n'>catch_all_css</span><span class='p'>(</span><span class='ss'>:sass</span><span class='p'>)</span>
</pre>
</div><div class='highlight'><pre><span class='k'>def</span> <span class='nf'>catch_all_css</span><span class='p'>(</span><span class='n'>handler</span><span class='o'>=</span><span class='ss'>:render</span><span class='p'>)</span>
  <span class='n'>get</span> <span class='s1'>&#39;/*.css&#39;</span> <span class='k'>do</span>
    <span class='n'>header</span> <span class='s1'>&#39;Content-Type&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;text/css; charset=utf-8&#39;</span>
    <span class='n'>resource</span> <span class='o'>=</span> <span class='n'>request</span><span class='o'>.</span><span class='n'>env</span><span class='o'>[</span><span class='s2'>&quot;PATH_INFO&quot;</span><span class='o'>].</span><span class='n'>match</span><span class='p'>(</span><span class='sr'>%r[\/(.+)\.css]</span><span class='p'>)</span><span class='o'>[</span><span class='mi'>1</span><span class='o'>].</span><span class='n'>to_sym</span>
    <span class='nb'>self</span><span class='o'>.</span><span class='n'>send</span><span class='p'>(</span><span class='n'>handler</span><span class='p'>,</span> <span class='n'>resource</span><span class='p'>)</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</pre>
</div>
<h3 id='something_ive_heard'>Something I&#8217;ve Heard</h3>

<p>I&#8217;ve <a href='http://www.gittr.com/index.php/archive/sinatra-splat-routes/'>heard</a> that a future version of Sinatra will allow me to get the value of the splats (the values matched by the asterisks of a route) from <code>params[&#39;splats&#39;]</code>. If this is true, we could modify <code>catch\_all\_css</code> to look like this:</p>
<div class='highlight'><pre><span class='n'>get</span><span class='p'>(</span><span class='s1'>&#39;/*.css&#39;</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>sass</span> <span class='n'>params</span><span class='o'>[</span><span class='s2'>&quot;splat&quot;</span><span class='o'>].</span><span class='n'>first</span><span class='o'>.</span><span class='n'>to_sym</span> <span class='p'>}</span>
</pre>
</div>
</div>


    </div>
    <div class='container'>
      <div class='clear' id='footer'>
        &copy; 2007 - 2009 Justin Knowlden,
        <span class='email'>gus at gusg dot us</span>
        <span class='powered'>
          - Powered by <a href=''>Jekyll</a>,
          <a href='http://daringfireball.net/projects/markdown/'>Markdown</a>,
          <a href='http://pygments.org/'>Pygments</a>, and me
        </span>
      </div>
    </div>
    <a href='http://github.com/jaknowlden'>
      <img alt='Fork me on GitHub' id='ribbon' src='http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' />
    </a>
    <script src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.3/prototype.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-1.2.6.min.js" type="text/javascript"></script>
    <script src="http://grumble.annealer.org/javascripts/grumbler/api.js" type="text/javascript"></script>
    <script src="/javascripts/grumble_support.js" type="text/javascript"></script>
  </body>
</html>