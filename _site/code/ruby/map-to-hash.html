<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta content='GROW UP' http-equiv='X-UA-Compatible' />
    <meta content='width=850' name='viewport' />
    <title>GusG.us - Makin' Mash</title>
    <link href='/images/gusgus_icon.gif' rel='icon' />
    <link href='http://gusg.us/feed.xml' rel='alternate' title='GusG.us' type='application/rss+xml' />
    <link href="/stylesheets/reset-min.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/application.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/pygment-native.css" type="text/css" media="screen" rel="stylesheet"/>
  </head>

  <body>
    <div class='container'>
      <div id='header'>
        <a href='http://gusg.us'>
          <img src='/images/gus-logo.png' />
        </a>
        <span class='nav'>
          <a href='/'>Home</a>
          <a href='/life'>Life</a>
          <a href='/work'>Work</a>
          <a href='/code'>Code</a>
          <a href='/code/ruby'>Ruby</a>
          <a href='/code/erlang'>Erlang</a>
        </span>
        <a href='http://feeds.feedburner.com/gusgus' rel='alternate' type='application/rss+xml'>
          <img src='http://www.feedburner.com/fb/images/pub/feed-icon16x16.png' />
        </a>
      </div>

      <div id="article">
  <h1>Makin' Mash</h1>
  <em>A Map to Hash implementation in Ruby</em>
  <cite>Sat May 31 00:00:00 -0500 2008</cite>
  <p>We all know and love the <code>map</code> method in Ruby (and other functional-ish languages). Given some list of objects, we get back an equal-sized array of potentially different objects. In Ruby we can <code>map</code> against arrays, hashes, sets, etc.; basically, anything that is <code>Enumerable</code>.</p>

<p>From time-to-time, though, I need to convert some list of object into a hash. Ergo, I need to <code>map-to-hash</code> or <code>mash</code>.</p>

<p>For instance, let&#8217;s say I want to map an array of User records to a hash with email addresses pointing to the User records? Without much thought I could write it this way:</p>
<div class='highlight'><pre><span class='n'>users</span> <span class='o'>=</span> <span class='no'>User</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='ss'>:all</span><span class='p'>)</span> <span class='c1'># Not smart :)</span>
<span class='n'>hashed_users</span> <span class='o'>=</span> <span class='n'>users</span><span class='o'>.</span><span class='n'>inject</span><span class='p'>({})</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>acc</span><span class='p'>,</span><span class='n'>u</span><span class='o'>|</span> 
  <span class='n'>acc</span><span class='o'>[</span><span class='n'>u</span><span class='o'>.</span><span class='n'>email</span><span class='o'>]</span> <span class='o'>=</span> <span class='n'>u</span>
  <span class='n'>acc</span>
<span class='k'>end</span>
</pre>
</div>
<p>I would rather do the following:</p>
<div class='highlight'><pre><span class='n'>users</span> <span class='o'>=</span> <span class='no'>User</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='ss'>:all</span><span class='p'>)</span> <span class='c1'># Still not smart :)</span>
<span class='n'>hashed_users</span> <span class='o'>=</span> <span class='n'>users</span><span class='o'>.</span><span class='n'>mash</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>u</span><span class='o'>|</span> <span class='p'>{</span><span class='n'>u</span><span class='o'>.</span><span class='n'>email</span> <span class='o'>=&gt;</span> <span class='n'>u</span><span class='p'>}</span> <span class='p'>}</span>
</pre>
</div>
<p>It&#8217;s not a <strong>HUGE</strong> change, but it does let me <em>say</em> what I want to <em>say</em> without all the <strong>acc</strong>umulator cruft.</p>

<h2 id='implementation'>Implementation</h2>

<p>Simple, straight forward, and usable by anything that is Enumerable.</p>
<div class='highlight'><pre><span class='k'>module</span> <span class='nn'>Enumerable</span>
  <span class='k'>def</span> <span class='nf'>mash</span>
    <span class='nb'>self</span><span class='o'>.</span><span class='n'>inject</span><span class='p'>({})</span> <span class='p'>{</span> <span class='o'>|</span><span class='n'>a</span><span class='p'>,</span><span class='n'>i</span><span class='o'>|</span> <span class='n'>a</span><span class='o'>.</span><span class='n'>merge</span><span class='p'>(</span> <span class='k'>yield</span><span class='p'>(</span><span class='n'>i</span><span class='p'>)</span> <span class='p'>)</span> <span class='p'>}</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</pre>
</div>
<h2 id='acknowledgements'>Acknowledgements</h2>

<p>After writing my <code>mash</code>, I realized others have probably done this many times before and a quick search found the below posts (Ruby specific). I was actually wrong about my assumption. I only found one post. Of course, I didn&#8217;t search very hard and other languages probably do the same.</p>

<ol>
<li><a href='http://snippets.dzone.com/posts/show/4805'>Map array to hash</a> - There are actually one too many loops in <a href='http://snippets.dzone.com/user/vinterbleg'>vinterbleg&#8217;s</a> implementation. And it&#8217;s Array specific where it should be Enumerable generic.</li>
</ol>
</div>
 
<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>05 Jan 2009</span> &raquo; <a href="/life/thumbly-going-on.html">Thumbly Going On</a></li>
    
      <li><span>03 Jan 2009</span> &raquo; <a href="/code/ruby/load-model.html">Load Model</a></li>
    
      <li><span>20 Dec 2008</span> &raquo; <a href="/life/boring-bed-poem.html">Poem - Boring Bed</a></li>
    
  </ul>
</div>


    </div>
    <div class='container'>
      <div class='clear' id='footer'>
        &copy; 2007 - 2009 Justin Knowlden,
        <span class='email'>gus at gusg dot us</span>
        <span class='powered'>
          - Powered by <a href=''>Jekyll</a>,
          <a href='http://daringfireball.net/projects/markdown/'>Markdown</a>,
          <a href='http://pygments.org/'>Pygments</a>, and me
        </span>
      </div>
    </div>
    <a href='http://github.com/jaknowlden'>
      <img alt='Fork me on GitHub' id='ribbon' src='http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' />
    </a>
    <script src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.3/prototype.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-1.2.6.min.js" type="text/javascript"></script>
    <script src="http://grumble.annealer.org/javascripts/grumbler/api.js" type="text/javascript"></script>
    <script src="/javascripts/grumble_support.js" type="text/javascript"></script>
  </body>
</html>