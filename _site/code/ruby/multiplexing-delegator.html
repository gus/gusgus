<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta content='GROW UP' http-equiv='X-UA-Compatible' />
    <meta content='width=960' name='viewport' />
    <title>The Knowldenist - Drink Up! - Multiplexing Delegator</title>
    <link href='/images/gusgus_icon.gif' rel='icon' />
    <link href="http://feeds.feedburner.com/gusgus" rel="alternate" title="The Knowldenist" type="application/atom+xml" />
    <link href='http://gusg.us/feed.xml' rel='alternate' title='The Knowldenist' type='application/atom+xml' />
    <link href="/stylesheets/reset.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/960.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/text.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/application.css" type="text/css" media="screen" rel="stylesheet"/>
    <link href="/stylesheets/pygment-native.css" type="text/css" media="screen" rel="stylesheet"/>
  </head>

  <body>
    <div class='container_12'>
      <div id='header'>
        <div id="title" class="grid_4 alpha">
          <span class="article">The</span><span class="noun"><a href="/">Knowldenist</a></span>
        </div>
        <div id="nav" class="grid_8 omega">
          <ul>
            <li>
              Read
              <ul><li><a href="/">Home</a></li></ul>
            </li>
            <li>
              Blurp!
              <ul><li><a href="/blurp/">Excuse me</a></li></ul>
            </li>
            <li>
              Code
              <ul>
                <li><a href="http://github.com/jaknowlden">jaknowlden</a></li>
                <li><a href="http://github.com/thumblemonks">thumblemonks</a></li>
              </ul>
            </li>
            <li>
              Links
              <ul>
                <li><a href="http://tumblr.gusg.us/">Tumblr</a></li>
                <li><a href="http://twitter.com/jaknowlden">Twittr</a></li>
                <li><a href="http://flickr.com/jaknowlden">Flickr</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div id="main" class='grid_12 alpha omega'>
        <div id="page_title">
  <h1>Multiplexing Delegator</h1>
  <div class="summary"><em>One person's brainfart is another person's gas-powered wind balloon</em></div>
</div>

<div class="grid_9 alpha">
  <div id="left" class="grid_3 alpha column">
    <ul>
      <h3>Into the Future</h3>
      <li>
        <a href="/code/ruby/json-in-rails-just-annoyed-me.html">JSON in Rails Just Annoyed Me</a>
        <p><em>Seriously, things just shouldn't be as hard as they are</em></p>
      </li>

      <li>
        <a href="/life/only-losers-are-unc-fans.html">Only Losers are UNC Fans - With Tests</a>
        <p><em>It's not JUST a game, man!</em></p>
      </li>
    </ul>
  </div>

  <div id="article" class="grid_6 omega">
    <div id="info">
      <div class="date"><cite>Jan 27, 2008</cite></div>
    </div>

    <div class="content"><p>I&#8217;ve got a <code>User</code>, see, and this <code>User</code> has a fever. And the only prescription for this fever is more <code>Network</code> (get <a href='http://www.vimeo.com/17746'>even more fever</a>). In fact, this <code>User</code> already has two <code>Networks</code>.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Network</span>
  <span class='c1'># The idea is that each of the accessors has an array of Users</span>
  <span class='kp'>attr_accessor</span> <span class='ss'>:active</span><span class='p'>,</span> <span class='ss'>:pending</span><span class='p'>,</span> <span class='ss'>:rejected</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>User</span>
  <span class='kp'>attr_accessor</span> <span class='ss'>:friend_network</span><span class='p'>,</span> <span class='ss'>:public_network</span>
  <span class='k'>def</span> <span class='nf'>initialize</span>
    <span class='vi'>@friend_network</span> <span class='o'>=</span> <span class='no'>Network</span><span class='o'>.</span><span class='n'>new</span>
    <span class='vi'>@public_network</span> <span class='o'>=</span> <span class='no'>Network</span><span class='o'>.</span><span class='n'>new</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre>
</div>
<p><em>This is, of course, a very simplified implementation of a solution that might be built in Rails with ActiveRecord.</em></p>

<p>That&#8217;s awesome. I can work with each of these <code>Networks</code> by adding to and removing from each of them individually. But, what if I wanted the list of all <code>Users</code> that a particular User is linked to and I don&#8217;t care which Network they are in?</p>

<p>I could do this if I wanted all of the active users:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>user</span><span class='o'>.</span><span class='n'>friend_network</span><span class='o'>.</span><span class='n'>active</span> <span class='o'>+</span> <span class='n'>user</span><span class='o'>.</span><span class='n'>public_network</span><span class='o'>.</span><span class='n'>active</span>
</code></pre>
</div>
<p>Or, I could push the logic into the model as would be expected; like so:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span>
  <span class='c1'># ...</span>
  <span class='k'>def</span> <span class='nf'>all_active_users</span>
    <span class='vi'>@friend_network</span><span class='o'>.</span><span class='n'>active</span> <span class='o'>+</span> <span class='vi'>@public_network</span><span class='o'>.</span><span class='n'>active</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>That&#8217;s fine. But what if I wanted the list of all rejected <code>Users</code>? What if I wanted to add more feverish <code>Networks</code>? A lot more code, that&#8217;s what!</p>

<h2 id='interpretation'>Interpretation</h2>

<p>So, of course, a solution is forthcoming. What I really want to do is delegate a single message across multiple receivers and aggregate the results into a single response. Kind of like I&#8217;m multiplexing messages and demultiplexing the response.</p>

<p>Here&#8217;s an example of what I would like to do given a User instance:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>user</span><span class='o'>.</span><span class='n'>entire_network</span><span class='o'>.</span><span class='n'>active</span>
</code></pre>
</div>
<p>What should happen in this call is that <code>entire_network</code> should know how to call <code>active</code> on both the <code>friend_network</code> and <code>public_network</code> accessors, and then collect the results into a single collection of Users.</p>

<p>Thusly and so forth, the <code>Multiplexing Delegator</code> has been born. Let the dust settle a little &#8230; and here is how I would define the <code>User</code> class:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span>
  <span class='kp'>attr_accessor</span> <span class='ss'>:friend_network</span><span class='p'>,</span> <span class='ss'>:public_network</span>

  <span class='n'>multiplex</span> <span class='ss'>:entire_network</span><span class='p'>,</span> <span class='ss'>:across</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='ss'>:friend_network</span><span class='p'>,</span> <span class='ss'>:public_network</span><span class='o'>]</span>

  <span class='k'>def</span> <span class='nf'>initialize</span>
    <span class='vi'>@friend_network</span> <span class='o'>=</span> <span class='no'>Network</span><span class='o'>.</span><span class='n'>new</span>
    <span class='vi'>@public_network</span> <span class='o'>=</span> <span class='no'>Network</span><span class='o'>.</span><span class='n'>new</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre>
</div>
<p>Assuming <code>friend_network</code> contains 3 <code>Users</code> and <code>public_network</code> contains 5 <code>Users</code>, a call to <code>entire_network</code> will return an array with 7 <code>Users</code>.</p>

<h2 id='application'>Application</h2>

<p>I know what you&#8217;re saying, <em>&#8220;Sure. It works great for your example, but what else is it useful for?&#8221;</em></p>

<p>And I say, <em>&#8220;I don&#8217;t really care all that much since it&#8217;s useful for me in this instance.&#8221;</em></p>

<p>But really, that&#8217;s not true. I do care; lest I wouldn&#8217;t have gone through all this effort to impress you. I see can <code>mutliplex</code> as being useful for aggregating any and many collections easily into one stream of results. Generally, the types of Objects being delegated to will be the same, but this does not have to be true.</p>

<p>Here&#8217;s something fun I did:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Object</span>
  <span class='n'>multiplex</span> <span class='ss'>:all_methods</span><span class='p'>,</span>
    <span class='ss'>:across</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='ss'>:public_methods</span><span class='p'>,</span> <span class='ss'>:protected_methods</span><span class='p'>,</span> <span class='ss'>:private_methods</span><span class='o'>]</span>
<span class='k'>end</span>
<span class='n'>obj</span> <span class='o'>=</span> <span class='no'>Object</span><span class='o'>.</span><span class='n'>new</span>
<span class='n'>obj</span><span class='o'>.</span><span class='n'>all_methods</span> <span class='o'>=&gt;</span> <span class='o'>[.</span><span class='n'>.</span><span class='o'>.]</span> <span class='c1'># Produced an array of all of the methods</span>
</code></pre>
</div>
<p>No &#8230; it does not match what is returned from <code>Object.methods</code>.</p>

<h2 id='installation'>Installation</h2>

<p>Simple and easy:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>gem</span> <span class='n'>install</span> <span class='n'>multiplexing_delegator</span>
<span class='c1'># or if you&#39;re boring</span>
<span class='n'>sudo</span> <span class='n'>gem</span> <span class='n'>install</span> <span class='n'>multiplexing_delegator</span>
</code></pre>
</div>
<p><a href='http://glomp.rubyforge.org/multiplexing_delegator'>Documentation</a> is served from <a href='http://rubyforge.org/projects/glomp'>RubyForge</a>, just like the <a href='http://glomp.rubyforge.org/svn/multiplexing_delegator'>source code</a>.</p></div>
  </div>

  
  <div id="grumble">
    <h4 class="count"></h4>
    <ul></ul>

    <div id="disqus_thread"></div>
    <script type="text/javascript" src="http://disqus.com/forums/gusgus/embed.js"></script>
    <noscript><a href="http://disqus.com/forums/gusgus/?url=ref">View the discussion thread.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">powered by <span class="logo-disqus">Disqus</span></a>
  </div>
  
</div>

<div id="right" class="grid_3 omega column">
  <ul>
    <h3>Into the Past</h3>
    <li>
      <a href="/code/beautiful-code-readability-performance.html">Readability and Performance is Beautiful Code</a>
      <p><em>Thoughts on what makes code beautiful</em></p>
    </li>

    <li>
      <a href="/life/active-record-modeling-life.html">Active Record Modeling Life</a>
      <p><em>Code and Life intertwined ... ewwwwww</em></p>
    </li>

    <p><em>
      Check out these fine products:
      <a href="http://ackandnak.com/">Ack &amp; Nak</a> many-days-a-week web comic,
      <a href="http://dailyjs.com/">DailyJS</a>,
      <a href="http://helicoid.net/">Helicoid</a>,
      <a href="http://swirrl.com/">Swirrl</a>,
      <a href="http://javagems.org/">Java Gems</a>, et al
    </em></p>
  </ul>
</div>

      </div>

      <div class='grid_12 alpha omega' id='footer'>
        <a href="http://feeds2.feedburner.com/gusgus" rel="alternate" type="application/rss+xml">
          <img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a>
        &copy; 2007 -  Justin Knowlden /
        <span id="other_thumble_monks">
          Other Thumble Monks:
          <a href="http://annealer.org/">Annealer</a>,
          <a href="http://github.com/danhodos">Sandman</a>,
          <a href="http://toothrot.net/">Toothrot</a>,
          <a href="http://hjstudios.com/">JankStar</a>,
          <a href="http://andrijevik.net/">Vladka</a>
        </span>
      </div>
    </div>

    <script src="/javascripts/jquery-1.3.2.min.js"></script>
    <script src="/javascripts/disqus.js"></script>
    <script src="/javascripts/application.js"></script>
    <script src="/javascripts/ga.js"></script>
  </body>
</html>